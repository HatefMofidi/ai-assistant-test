<?php
class AI_Assistant_Api_Handler {
    private static $instance;
    private $api_key;
    private $logger;

    public static function init() {
        if (is_null(self::$instance)) {
            self::$instance = new self();
        }
        return self::$instance;
    }

    private function __construct() {
        // ØªØºÛŒÛŒØ± Ù†Ø§Ù… option Ø¨Ù‡ ai_assistant_deepseek_key
        $this->api_key = get_option('ai_assistant_deepseek_key');
        $this->logger = AI_Assistant_Logger::get_instance();
        

        $this->register_hooks();

        // Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² ÙˆØ¬ÙˆØ¯ Ù¾ÙˆØ´Ù‡ Ù„Ø§Ú¯
        if (!file_exists(WP_CONTENT_DIR.'/ai-assistant-logs')) {
            wp_mkdir_p(WP_CONTENT_DIR.'/ai-assistant-logs');
        }
    }   

    private function register_hooks() {
        add_action('admin_menu', [$this, 'add_admin_page']);
        add_action('admin_init', [$this, 'register_settings']);
        add_action('wp_ajax_ai_assistant_process', [$this, 'process_request']);
        add_action('wp_ajax_nopriv_ai_assistant_process', [$this, 'handle_unauthorized']);
    }

    public function add_admin_page() {
        add_options_page(
            'ØªÙ†Ø¸ÛŒÙ…Ø§Øª DeepSeek',
            'DeepSeek_API',
            'manage_options',
            'ai_assistant-settings', // ØªØºÛŒÛŒØ± Ù†Ø§Ù… Ù…Ù†Ùˆ
            [$this, 'render_admin_page']
        );
    }

    public function register_settings() {
        register_setting('ai_assistant_settings', 'ai_assistant_deepseek_key'); // ØªØºÛŒÛŒØ± Ù†Ø§Ù… ØªÙ†Ø¸ÛŒÙ…Ø§Øª

        add_settings_section(
            'ai_assistant_api_section', // ØªØºÛŒÛŒØ± Ù†Ø§Ù… Ø³Ú©Ø´Ù†
            'ØªÙ†Ø¸ÛŒÙ…Ø§Øª API',
            null,
            'ai_assistant-settings'
        );

        add_settings_field(
            'ai_assistant_deepseek_key', // ØªØºÛŒÛŒØ± Ù†Ø§Ù… ÙÛŒÙ„Ø¯
            'API Key',
            [$this, 'render_api_key_field'],
            'ai_assistant-settings',
            'ai_assistant_api_section'
        );
    }

    public function render_api_key_field() {
        $value = esc_attr($this->api_key);
        echo '<input type="password" name="ai_assistant_deepseek_key" value="'.$value.'" class="regular-text">'; // ØªØºÛŒÛŒØ± Ù†Ø§Ù… ÙÛŒÙ„Ø¯
    }

    public function render_admin_page() {
        ?>
        <div class="wrap">
            <h1>ØªÙ†Ø¸ÛŒÙ…Ø§Øª DeepSeek API</h1>
            <form method="post" action="options.php">
                <?php
                settings_fields('ai_assistant_settings');
                do_settings_sections('ai_assistant-settings');
                submit_button();
                ?>
            </form>

            <h2>Ù„Ø§Ú¯ Ø®Ø·Ø§Ù‡Ø§</h2>
            <pre><?php 
                if (!current_user_can('administrator')) {
                    echo 'Ø¯Ø³ØªØ±Ø³ÛŒ Ù…Ø¬Ø§Ø² Ù†ÛŒØ³Øª.';
                    return;
                }

                $log_file = WP_CONTENT_DIR . '/ai-assistant-logs/ai-assistant.log';
                echo file_exists($log_file) ? 
                     esc_html(file_get_contents($log_file)) : 
                     'Ù„Ø§Ú¯ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯';
            ?></pre>
        </div>
        <?php
    }

    public function process_request() {
        check_ajax_referer('ai_assistant_nonce', 'security');         

        if (ob_get_length()) ob_clean();

        try {
            $user_id = get_current_user_id();
            if (!$user_id) {
                wp_send_json_error(__('Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø§ÛŒÙ† Ø³Ø±ÙˆÛŒØ³ Ø¨Ø§ÛŒØ¯ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯.', 'ai-assistant'));
            }
            
        //    $service_name = sanitize_text_field($_POST['name']);
            $service_id = sanitize_text_field($_POST['service_id']);
            $userData = stripslashes($_POST['userData']);
            
            $all_services = get_option('ai_assistant_services', []);
            // $system_prompt = $all_services[$service_id]['system_prompt'] ?? '';
            // $prompt = $system_prompt . "\n\n" . $userData;

            $service_name = $all_services[$service_id]['name'];
            $service_manager = AI_Assistant_Service_Manager::get_instance();
            $price = $service_manager->get_service_price($service_id);
            
            $service_info = $service_manager->get_service($service_id);
            if ($service_info && isset($service_info['system_prompt'])) {
                $system_prompt = $service_info['system_prompt'];
                // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² system_prompt
                error_log('System Prompt: ' . $system_prompt);
            } else {
                error_log('Service not found or system_prompt not set');
            }
            
            $prompt = $system_prompt . "\n\n" . $userData;
            
            if ($price === 0) {
            //    $all_services = get_option('ai_assistant_services', []);
                $price = $all_services[$service_id]['price'] ?? 0;
            }
            
            
            
            $payment_handler = AI_Assistant_Payment_Handler::get_instance();
            
        
            $this->validate_request($prompt, $service_id, $user_id, $price, $payment_handler);

            // Ú©Ø³Ø± Ù‡Ø²ÛŒÙ†Ù‡
            $payment_handler->deduct_credit($user_id, $price, $service_name);

            // Ø«Ø¨Øª Ù„Ø§Ú¯
            $this->logger->log('Processing API request', [
                'user_id:' => $user_id,
                'service_id:' => $service_id,
                'price:' => $price,
                'prompt:' => $prompt
            ]);

            // ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ API------------------------------------------------------
        //   $response = $this->call_deepseek_api($prompt);
            //-----------------------------------------------------------------


   

$json_string = ' 
{
  "title": "Ø¨Ø±Ù†Ø§Ù…Ù‡ ØªØºØ°ÛŒÙ‡â€ŒØ§ÛŒ Ø¨Ø§Ù„ÛŒÙ†ÛŒ",
  "sections": [
    {
      "title": "Ø§Ø®Ø·Ø§Ø±",
      "content": {
        "type": "paragraph",
        "text": "Ø¨Ø§ ØªÙˆØ¬Ù‡ Ø¨Ù‡ Ø´Ø±Ø§ÛŒØ· Ø®Ø§Øµ Ø´Ù…Ø§ (Ù¾Ø§Ø±Ø§ØªÛŒØ±ÙˆØ¦ÛŒØ¯ Ùˆ Ù¾ÛŒÙˆÙ†Ø¯ Ú©Ù„ÛŒÙ‡)ØŒ Ù„Ø·ÙØ§Ù‹ Ù‚Ø¨Ù„ Ø§Ø² Ø´Ø±ÙˆØ¹ Ø§ÛŒÙ† Ø±Ú˜ÛŒÙ… ØºØ°Ø§ÛŒÛŒ Ø¨Ø§ Ù¾Ø²Ø´Ú© Ù…Ø¹Ø§Ù„Ø¬ Ø®ÙˆØ¯ Ù…Ø´ÙˆØ±Øª Ú©Ù†ÛŒØ¯. Ø§ÛŒÙ† Ø¨Ø±Ù†Ø§Ù…Ù‡ ØµØ±ÙØ§Ù‹ Ø¬Ù†Ø¨Ù‡ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ Ø¯Ø§Ø±Ø¯ Ùˆ Ù…Ù…Ú©Ù† Ø§Ø³Øª Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø®Ø§Øµ Ø¨Ø±Ø§ÛŒ Ø´Ø±Ø§ÛŒØ· Ø´Ù…Ø§ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯."
      }
    },
    {
      "title": "Û±. Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¶Ø±ÙˆØ±ÛŒ Ú©Ø§Ø±Ø¨Ø±",
      "content": {
        "type": "list",
        "items": [
          {"label": "Ø³Ù†", "value": "36 Ø³Ø§Ù„"},
          {"label": "Ø¬Ù†Ø³ÛŒØª", "value": "Ù…Ø±Ø¯"},
          {"label": "ÙˆØ²Ù† Ùˆ Ù‚Ø¯", "value": "81 Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…ØŒ 175 Ø³Ø§Ù†ØªÛŒâ€ŒÙ…ØªØ±"},
          {"label": "Ø¨ÛŒÙ…Ø§Ø±ÛŒâ€ŒÙ‡Ø§/Ø¯Ø§Ø±ÙˆÙ‡Ø§", "value": "Ù¾Ø§Ø±Ø§ØªÛŒØ±ÙˆØ¦ÛŒØ¯ØŒ Ù¾ÛŒÙˆÙ†Ø¯ Ú©Ù„ÛŒÙ‡"},
          {"label": "Ø³Ø·Ø­ ÙØ¹Ø§Ù„ÛŒØª", "value": "Ú©Ù…"},
          {"label": "Ù‡Ø¯Ù", "value": "Ø­ÙØ¸ Ø³Ù„Ø§Ù…ØªÛŒ"},
          {"label": "Ù…Ø¯Øª Ø²Ù…Ø§Ù† Ø¨Ø±Ù†Ø§Ù…Ù‡", "value": "Ø§ÛŒÙ† Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¨Ø±Ø§ÛŒ Ù‡ÙØª Ø±ÙˆØ² Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡ Ø§Ø³Øª. Ø¨Ø§ ØªÙˆØ¬Ù‡ Ø¨Ù‡ Ø´Ø±Ø§ÛŒØ· Ø®Ø§Øµ Ø´Ù…Ø§ØŒ Ø¨Ù‡ØªØ± Ø§Ø³Øª Ù¾Ø³ Ø§Ø² ÛŒÚ© Ù‡ÙØªÙ‡ Ø¨Ø§ Ù¾Ø²Ø´Ú© Ù…Ø¹Ø§Ù„Ø¬ Ø®ÙˆØ¯ Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ø§Ù…Ù‡ ÛŒØ§ ØªØ¹Ø¯ÛŒÙ„ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù…Ø´ÙˆØ±Øª Ú©Ù†ÛŒØ¯."}
        ]
      }
    },
    {
      "title": "Û². ØªØ­Ù„ÛŒÙ„ Ø¹Ù„Ù…ÛŒ",
      "content": {
        "type": "paragraph",
        "text": "Ø¨Ø§ ØªÙˆØ¬Ù‡ Ø¨Ù‡ Ø´Ø±Ø§ÛŒØ· Ø´Ù…Ø§ (Ù¾ÛŒÙˆÙ†Ø¯ Ú©Ù„ÛŒÙ‡ Ùˆ Ù¾Ø§Ø±Ø§ØªÛŒØ±ÙˆØ¦ÛŒØ¯)ØŒ Ø±Ú˜ÛŒÙ… ØºØ°Ø§ÛŒÛŒ Ø¨Ø§ÛŒØ¯ Ú©Ù†ØªØ±Ù„ Ø´Ø¯Ù‡ Ø§Ø² Ù†Ø¸Ø± Ù¾Ø±ÙˆØªØ¦ÛŒÙ†ØŒ ÙØ³ÙØ±ØŒ Ù¾ØªØ§Ø³ÛŒÙ… Ùˆ Ø³Ø¯ÛŒÙ… Ø¨Ø§Ø´Ø¯. Ù…Ø·Ø§Ù„Ø¹Ø§Øª Ù†Ø´Ø§Ù† Ù…ÛŒâ€ŒØ¯Ù‡Ù†Ø¯ Ú©Ù‡ Ø¨ÛŒÙ…Ø§Ø±Ø§Ù† Ù¾ÛŒÙˆÙ†Ø¯ Ú©Ù„ÛŒÙ‡ Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªÙ†Ø¸ÛŒÙ… Ø¯Ù‚ÛŒÙ‚ Ø§ÛŒÙ† Ù…ÙˆØ§Ø¯ Ù…ØºØ°ÛŒ Ø¯Ø§Ø±Ù†Ø¯ (Journal of Renal Nutrition, 2020). Ù‡Ù…Ú†Ù†ÛŒÙ†ØŒ Ø³Ø·Ø­ Ú©Ù„Ø³ÛŒÙ… Ùˆ ÙˆÛŒØªØ§Ù…ÛŒÙ† D Ø¨Ø§ÛŒØ¯ Ø¨Ù‡ Ø¯Ù‚Øª Ú©Ù†ØªØ±Ù„ Ø´ÙˆØ¯ (Clinical Journal of the American Society of Nephrology, 2019). Ø±Ú˜ÛŒÙ… Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ Ø¨Ø§ Ø¯Ø± Ù†Ø¸Ø± Ú¯Ø±ÙØªÙ† Ø§ÛŒÙ† Ù…ÙˆØ§Ø±Ø¯ Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡ Ø§Ø³Øª."
      }
    },
    {
      "title": "Û³. Ù†ØªÛŒØ¬Ù‡ Ù…ÙˆØ±Ø¯ Ø§Ù†ØªØ¸Ø§Ø±",
      "content": {
        "type": "nested_list",
        "items": [
          {
            "label": "ÙˆØ¶Ø¹ÛŒØª ÙˆØ²Ù† ÙØ¹Ù„ÛŒ Ø´Ù…Ø§ Ù†Ø³Ø¨Øª Ø¨Ù‡ Ù…Ø­Ø¯ÙˆØ¯Ù‡â€ŒÛŒ Ø§ÛŒØ¯Ù‡â€ŒØ¢Ù„",
            "value": "Ø´Ø§Ø®Øµ ØªÙˆØ¯Ù‡ Ø¨Ø¯Ù†ÛŒ (BMI) Ø´Ù…Ø§ 26.4 Ø§Ø³Øª Ú©Ù‡ Ø¯Ø± Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ø§Ø¶Ø§ÙÙ‡ ÙˆØ²Ù† Ù‚Ø±Ø§Ø± Ø¯Ø§Ø±Ø¯. ÙˆØ²Ù† Ø§ÛŒØ¯Ù‡â€ŒØ¢Ù„ Ø¨Ø±Ø§ÛŒ Ù‚Ø¯ Ø´Ù…Ø§ Ø­Ø¯ÙˆØ¯ 70-75 Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù… Ø§Ø³Øª."
          },
          {
            "label": "Ù†ØªÛŒØ¬Ù‡ Ù…ÙˆØ±Ø¯ Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø¹Ø¯ Ø§Ø² ÛŒÚ© Ø¯ÙˆØ±Ù‡ Ø±Ø¹Ø§ÛŒØª Ø±Ú˜ÛŒÙ…",
            "value": "Ø¨Ø§ Ø±Ø¹Ø§ÛŒØª Ø§ÛŒÙ† Ø±Ú˜ÛŒÙ… ØºØ°Ø§ÛŒÛŒ Ø¨Ù‡ Ù…Ø¯Øª ÛŒÚ© Ù‡ÙØªÙ‡ØŒ Ø§Ù†ØªØ¸Ø§Ø± Ù…ÛŒâ€ŒØ±ÙˆØ¯ ØªØ¹Ø§Ø¯Ù„ Ù…ÙˆØ§Ø¯ Ù…ØºØ°ÛŒ Ø¯Ø± Ø¨Ø¯Ù† Ø´Ù…Ø§ Ø¨Ù‡Ø¨ÙˆØ¯ ÛŒØ§Ø¨Ø¯ Ùˆ Ø§Ø­ØªÙ…Ø§Ù„Ø§Ù‹ Ù…Ù‚Ø¯Ø§Ø±ÛŒ Ø§Ø² ÙˆØ²Ù† Ø§Ø¶Ø§ÙÛŒ Ú©Ø§Ù‡Ø´ ÛŒØ§Ø¨Ø¯. Ø§Ù…Ø§ Ø¨Ø§ ØªÙˆØ¬Ù‡ Ø¨Ù‡ Ø´Ø±Ø§ÛŒØ· Ø®Ø§Øµ Ø´Ù…Ø§ØŒ Ú©Ø§Ù‡Ø´ ÙˆØ²Ù† Ø¨Ø§ÛŒØ¯ Ø¨Ø³ÛŒØ§Ø± ØªØ¯Ø±ÛŒØ¬ÛŒ Ùˆ ØªØ­Øª Ù†Ø¸Ø± Ù¾Ø²Ø´Ú© Ø¨Ø§Ø´Ø¯."
          }
        ]
      }
    },
    {
      "title": "Û´. Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒÛŒ Ø¹Ù…Ù„ÛŒ",
      "content": [
        {
          "subtitle": "Ø§Ù„Ù) Ú©Ù„ÛŒØ§Øª Ø¨Ø±Ù†Ø§Ù…Ù‡:",
          "type": "list",
          "items": [
            {"label": "Ú©Ø§Ù„Ø±ÛŒ Ø±ÙˆØ²Ø§Ù†Ù‡", "value": "2000-2200 Ú©Ø§Ù„Ø±ÛŒ"},
            {"label": "Ø¯Ø±Ø´Øªâ€ŒÙ…ØºØ°ÛŒâ€ŒÙ‡Ø§", "value": "50Ùª Ú©Ø±Ø¨ÙˆÙ‡ÛŒØ¯Ø±Ø§ØªØŒ 25Ùª Ù¾Ø±ÙˆØªØ¦ÛŒÙ†ØŒ 25Ùª Ú†Ø±Ø¨ÛŒ"},
            {"label": "Ù…Ú©Ù…Ù„â€ŒÙ‡Ø§ (Ø¯Ø± ØµÙˆØ±Øª Ù†ÛŒØ§Ø²)", "value": "Ù…Ú©Ù…Ù„ Ú©Ù„Ø³ÛŒÙ… Ùˆ ÙˆÛŒØªØ§Ù…ÛŒÙ† D ÙÙ‚Ø· Ø¨Ø§ ØªØ¬ÙˆÛŒØ² Ù¾Ø²Ø´Ú©"}
          ]
        },
        {
          "subtitle": "Ø¨) Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒÛŒ ØºØ°Ø§ÛŒÛŒ Ù‡ÙØªÚ¯ÛŒ:",
          "type": "table",
          "headers": ["Ø±ÙˆØ²", "ØµØ¨Ø­Ø§Ù†Ù‡", "Ù…ÛŒØ§Ù†â€ŒÙˆØ¹Ø¯Ù‡ ØµØ¨Ø­", "Ù†Ø§Ù‡Ø§Ø±", "Ù…ÛŒØ§Ù†â€ŒÙˆØ¹Ø¯Ù‡ Ø¹ØµØ±", "Ø´Ø§Ù…"],
          "rows": [
            ["Ø±ÙˆØ² Ø§ÙˆÙ„", "Ù†Ø§Ù† Ø³Ù†Ú¯Ú© 2 Ø¨Ø±Ø´ (80 Ú¯Ø±Ù…) + Ù¾Ù†ÛŒØ± Ú©Ù… Ù†Ù…Ú© 30 Ú¯Ø±Ù… + Ú¯Ø±Ø¯Ùˆ 2 Ø¹Ø¯Ø¯ + Ú†Ø§ÛŒ Ú©Ù… Ø±Ù†Ú¯", "Ù…ÛŒÙˆÙ‡ ÙØµÙ„ (Ø³ÛŒØ¨ Ú©ÙˆÚ†Ú© 1 Ø¹Ø¯Ø¯) + Ø¨Ø§Ø¯Ø§Ù… 5 Ø¹Ø¯Ø¯", "Ø®ÙˆØ±Ø§Ú© Ù…Ø±Øº Ø¨Ø§ Ø³Ø¨Ø²ÛŒØ¬Ø§Øª (100 Ú¯Ø±Ù… Ø³ÛŒÙ†Ù‡ Ù…Ø±Øº + 1 ÙÙ†Ø¬Ø§Ù† Ø³Ø¨Ø²ÛŒØ¬Ø§Øª Ø¨Ø®Ø§Ø±Ù¾Ø²) + Ø¨Ø±Ù†Ø¬ Ù‚Ù‡ÙˆÙ‡â€ŒØ§ÛŒ Ù†ØµÙ Ù¾ÛŒÙ…Ø§Ù†Ù‡", "Ù…Ø§Ø³Øª Ú©Ù… Ú†Ø±Ø¨ (1 Ù¾ÛŒØ§Ù„Ù‡ Ú©ÙˆÚ†Ú©) + Ù†Ø§Ù† Ø®Ø´Ú© 1 Ø¹Ø¯Ø¯", "Ù…Ø§Ù‡ÛŒ Ù‚Ø²Ù„â€ŒØ¢Ù„Ø§ 100 Ú¯Ø±Ù… + Ø³ÛŒØ¨ Ø²Ù…ÛŒÙ†ÛŒ Ø¢Ø¨Ù¾Ø² Ú©ÙˆÚ†Ú© 1 Ø¹Ø¯Ø¯ + Ø³Ø§Ù„Ø§Ø¯ ÙØµÙ„ Ø¨Ø§ Ø±ÙˆØºÙ† Ø²ÛŒØªÙˆÙ†"],
            ["Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ø±ÙˆØ² Ø§ÙˆÙ„", "Ø¨Ù„ØºÙˆØ± Ø¬Ùˆ Ø¯ÙˆØ³Ø± (Ù†ØµÙ Ù¾ÛŒÙ…Ø§Ù†Ù‡ Ù¾Ø®ØªÙ‡) + Ø´ÛŒØ± Ú©Ù… Ú†Ø±Ø¨ (1 Ù„ÛŒÙˆØ§Ù†) + Ú©Ø´Ù…Ø´ 1 Ù‚Ø§Ø´Ù‚ ØºØ°Ø§Ø®ÙˆØ±ÛŒ", "Ù‡ÙˆÛŒØ¬ Ú©ÙˆÚ†Ú© 2 Ø¹Ø¯Ø¯ + Ø­Ù…Øµ 2 Ù‚Ø§Ø´Ù‚ ØºØ°Ø§Ø®ÙˆØ±ÛŒ", "Ø¹Ø¯Ø³ Ù¾Ù„Ùˆ Ø¨Ø§ Ù…Ø±Øº (Ù†ØµÙ Ù¾ÛŒÙ…Ø§Ù†Ù‡) + Ø³Ø§Ù„Ø§Ø¯ Ø´ÛŒØ±Ø§Ø²ÛŒ", "Ù¾Ù†ÛŒØ± Ú©Ù… Ù†Ù…Ú© 30 Ú¯Ø±Ù… + Ù†Ø§Ù† Ø³Ù†Ú¯Ú© 1 Ø¨Ø±Ø´", "Ø§Ù…Ù„Øª Ø³Ø¨Ø²ÛŒØ¬Ø§Øª (2 ØªØ®Ù… Ù…Ø±Øº + Ø³Ø¨Ø²ÛŒØ¬Ø§Øª Ù…Ø¹Ø·Ø±) + Ù†Ø§Ù† Ø³Ù†Ú¯Ú© 1 Ø¨Ø±Ø´"],
            ["Ø±ÙˆØ² Ø¯ÙˆÙ…", "Ø§ÙˆØªÙ…ÛŒÙ„ (Ù†ØµÙ Ù¾ÛŒÙ…Ø§Ù†Ù‡ Ø¬Ùˆ Ù¾Ø±Ú© + 1 Ù„ÛŒÙˆØ§Ù† Ø´ÛŒØ± Ú©Ù… Ú†Ø±Ø¨ + Ø¯Ø§Ø±Ú†ÛŒÙ†) + Ù…ÙˆØ² Ú©ÙˆÚ†Ú© Ù†ØµÙ", "Ù…Ø§Ø³Øª Ú©Ù… Ú†Ø±Ø¨ (1 Ù¾ÛŒØ§Ù„Ù‡ Ú©ÙˆÚ†Ú©) + Ú¯Ø±Ø¯Ùˆ 2 Ø¹Ø¯Ø¯", "Ú©Ø¨Ø§Ø¨ ØªØ§Ø¨Ù‡â€ŒØ§ÛŒ Ú¯ÙˆØ´Øª Ú©Ù… Ú†Ø±Ø¨ (100 Ú¯Ø±Ù…) + Ø¨Ø±Ù†Ø¬ Ø³ÙÛŒØ¯ Ù†ØµÙ Ù¾ÛŒÙ…Ø§Ù†Ù‡ + Ø³Ø¨Ø²ÛŒ Ø®ÙˆØ±Ø¯Ù†", "Ù†Ø®ÙˆØ¯Ú†ÛŒ 1 Ù…Ø´Øª Ú©ÙˆÚ†Ú© + Ú©Ø´Ù…Ø´ 1 Ù‚Ø§Ø´Ù‚ ØºØ°Ø§Ø®ÙˆØ±ÛŒ", "Ø³ÙˆÙ¾ Ø¬Ùˆ Ø¨Ø§ Ø³Ø¨Ø²ÛŒØ¬Ø§Øª (1 Ú©Ø§Ø³Ù‡ Ù…ØªÙˆØ³Ø·) + Ù†Ø§Ù† Ø³Ù†Ú¯Ú© 1 Ø¨Ø±Ø´"],
            ["Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ø±ÙˆØ² Ø¯ÙˆÙ…", "ØªØ®Ù… Ù…Ø±Øº Ø¢Ø¨Ù¾Ø² 2 Ø¹Ø¯Ø¯ + Ù†Ø§Ù† Ø³Ù†Ú¯Ú© 1 Ø¨Ø±Ø´ + Ú¯ÙˆØ¬Ù‡ ÙØ±Ù†Ú¯ÛŒ 2 Ø¨Ø±Ø´", "Ø§Ù†Ø¬ÛŒØ± Ø®Ø´Ú© 2 Ø¹Ø¯Ø¯ + Ø¨Ø§Ø¯Ø§Ù… 5 Ø¹Ø¯Ø¯", "Ø®ÙˆØ±Ø§Ú© Ù„ÙˆØ¨ÛŒØ§ Ú†ÛŒØªÛŒ Ø¨Ø§ Ø³Ø¨Ø²ÛŒØ¬Ø§Øª (Ù†ØµÙ Ù¾ÛŒÙ…Ø§Ù†Ù‡) + Ù†Ø§Ù† Ø³Ù†Ú¯Ú© 1 Ø¨Ø±Ø´", "Ù¾ÙˆØ±Ù‡ Ø³ÛŒØ¨ Ø²Ù…ÛŒÙ†ÛŒ Ú©ÙˆÚ†Ú© (1 Ø³ÛŒØ¨ Ø²Ù…ÛŒÙ†ÛŒ Ú©ÙˆÚ†Ú©) + Ø±ÙˆØºÙ† Ø²ÛŒØªÙˆÙ† 1 Ù‚Ø§Ø´Ù‚ Ú†Ø§ÛŒØ®ÙˆØ±ÛŒ", "Ù…Ø±Øº Ø¢Ø¨Ù¾Ø² 100 Ú¯Ø±Ù… + Ù¾ÙˆØ±Ù‡ Ù‡ÙˆÛŒØ¬ (1 Ù‡ÙˆÛŒØ¬ Ù…ØªÙˆØ³Ø·) + Ù†Ø§Ù† Ø³Ù†Ú¯Ú© 1 Ø¨Ø±Ø´"],
            ["Ø±ÙˆØ² Ø³ÙˆÙ…", "Ù¾Ù†ÛŒØ± Ú©Ù… Ù†Ù…Ú© 30 Ú¯Ø±Ù… + Ù†Ø§Ù† Ø³Ù†Ú¯Ú© 2 Ø¨Ø±Ø´ + Ø®ÛŒØ§Ø± 1 Ø¹Ø¯Ø¯ Ú©ÙˆÚ†Ú© + Ú†Ø§ÛŒ Ú©Ù… Ø±Ù†Ú¯", "Ù…ÛŒÙˆÙ‡ ÙØµÙ„ (Ù†Ø§Ø±Ù†Ú¯ÛŒ 1 Ø¹Ø¯Ø¯ Ù…ØªÙˆØ³Ø·) + Ù¾Ø³ØªÙ‡ 10 Ø¹Ø¯Ø¯", "Ù‚ÙˆØ±Ù…Ù‡ Ø³Ø¨Ø²ÛŒ Ø¨Ø§ Ù„ÙˆØ¨ÛŒØ§ Ù‚Ø±Ù…Ø² (Ù†ØµÙ Ù¾ÛŒÙ…Ø§Ù†Ù‡) + Ø¨Ø±Ù†Ø¬ Ø³ÙÛŒØ¯ Ù†ØµÙ Ù¾ÛŒÙ…Ø§Ù†Ù‡", "Ø´ÛŒØ± Ú©Ù… Ú†Ø±Ø¨ (1 Ù„ÛŒÙˆØ§Ù†) + Ø¨ÛŒØ³Ú©ÙˆÛŒØª Ø³Ø¨ÙˆØ³ Ø¯Ø§Ø± 2 Ø¹Ø¯Ø¯", "Ú©ØªÙ‡ Ú¯Ø´Ù†ÛŒØ² Ø¨Ø§ Ù…Ø§Ù‡ÛŒ (100 Ú¯Ø±Ù… Ù…Ø§Ù‡ÛŒ + Ù†ØµÙ Ù¾ÛŒÙ…Ø§Ù†Ù‡ Ø¨Ø±Ù†Ø¬ Ù…Ø®Ù„ÙˆØ· Ø¨Ø§ Ú¯Ø´Ù†ÛŒØ²)"],
            ["Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ø±ÙˆØ² Ø³ÙˆÙ…", "Ø­Ù„ÛŒÙ… Ø¬Ùˆ (1 Ú©Ø§Ø³Ù‡ Ú©ÙˆÚ†Ú©) + Ø´ÛŒØ±Ù‡ Ø§Ù†Ú¯ÙˆØ± 1 Ù‚Ø§Ø´Ù‚ Ú†Ø§ÛŒØ®ÙˆØ±ÛŒ", "Ú©Ø¯Ùˆ ØªÙ†Ø¨Ù„ Ù¾Ø®ØªÙ‡ (1 ÙÙ†Ø¬Ø§Ù†) + Ø±ÙˆØºÙ† Ø²ÛŒØªÙˆÙ† 1 Ù‚Ø§Ø´Ù‚ Ú†Ø§ÛŒØ®ÙˆØ±ÛŒ", "Ø®ÙˆØ±Ø§Ú© Ø¨Ø§Ø¯Ù…Ø¬Ø§Ù† Ø¨Ø§ Ú¯ÙˆØ´Øª Ú†Ø±Ø® Ú©Ø±Ø¯Ù‡ Ú©Ù… Ú†Ø±Ø¨ (Ù†ØµÙ Ù¾ÛŒÙ…Ø§Ù†Ù‡) + Ù†Ø§Ù† Ø³Ù†Ú¯Ú© 1 Ø¨Ø±Ø´", "Ø§Ù†Ø§Ø± Ù†ØµÙ ÛŒÚ© Ø§Ù†Ø§Ø± Ú©ÙˆÚ†Ú©", "Ø³ÛŒÙ†Ù‡ Ø¨ÙˆÙ‚Ù„Ù…ÙˆÙ† Ú¯Ø±ÛŒÙ„ Ø´Ø¯Ù‡ 100 Ú¯Ø±Ù… + Ù¾ÙˆØ±Ù‡ Ú©Ø¯Ùˆ Ø­Ù„ÙˆØ§ÛŒÛŒ (1 ÙÙ†Ø¬Ø§Ù†) + Ù†Ø§Ù† Ø³Ù†Ú¯Ú© 1 Ø¨Ø±Ø´"],
            ["Ø±ÙˆØ² Ú†Ù‡Ø§Ø±Ù…", "ØªØ®Ù… Ù…Ø±Øº Ù†ÛŒÙ…Ø±Ùˆ (1 Ø¹Ø¯Ø¯) + Ù†Ø§Ù† Ø³Ù†Ú¯Ú© 1 Ø¨Ø±Ø´ + Ú¯ÙˆØ¬Ù‡ ÙØ±Ù†Ú¯ÛŒ 2 Ø¨Ø±Ø´", "Ù…Ø§Ø³Øª Ú©Ù… Ú†Ø±Ø¨ (1 Ù¾ÛŒØ§Ù„Ù‡ Ú©ÙˆÚ†Ú©) + Ù†Ø§Ù† Ø®Ø´Ú© 1 Ø¹Ø¯Ø¯", "Ø¢Ø¨Ú¯ÙˆØ´Øª Ú©Ù… Ú†Ø±Ø¨ (1 Ú©Ø§Ø³Ù‡ Ú©ÙˆÚ†Ú©) + Ù†Ø§Ù† Ø³Ù†Ú¯Ú© 1 Ø¨Ø±Ø´", "Ù…ÛŒÙˆÙ‡ ÙØµÙ„ (Ú©ÛŒÙˆÛŒ 1 Ø¹Ø¯Ø¯) + Ø¨Ø§Ø¯Ø§Ù… 5 Ø¹Ø¯Ø¯", "Ù…Ø§Ù‡ÛŒ Ø³ÙÛŒØ¯ Ø¨Ø®Ø§Ø±Ù¾Ø² 100 Ú¯Ø±Ù… + Ø¨Ø±Ù†Ø¬ Ù‚Ù‡ÙˆÙ‡â€ŒØ§ÛŒ Ù†ØµÙ Ù¾ÛŒÙ…Ø§Ù†Ù‡ + Ø³Ø¨Ø²ÛŒØ¬Ø§Øª Ø¨Ø®Ø§Ø±Ù¾Ø²"],
            ["Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ø±ÙˆØ² Ú†Ù‡Ø§Ø±Ù…", "Ù¾Ù†ÛŒØ± Ú©Ù… Ù†Ù…Ú© 30 Ú¯Ø±Ù… + Ú¯Ø±Ø¯Ùˆ 2 Ø¹Ø¯Ø¯ + Ù†Ø§Ù† Ø³Ù†Ú¯Ú© 1 Ø¨Ø±Ø´ + Ú†Ø§ÛŒ Ú©Ù… Ø±Ù†Ú¯", "Ø³ÛŒÙ†Ù‡ Ù…Ø±Øº Ø¢Ø¨Ù¾Ø² 50 Ú¯Ø±Ù… + Ø®ÛŒØ§Ø± 1 Ø¹Ø¯Ø¯ Ú©ÙˆÚ†Ú©", "Ù„ÙˆØ¨ÛŒØ§ Ø³Ø¨Ø² Ù¾Ù„Ùˆ Ø¨Ø§ Ù…Ø±Øº (Ù†ØµÙ Ù¾ÛŒÙ…Ø§Ù†Ù‡) + Ù…Ø§Ø³Øª Ú©Ù… Ú†Ø±Ø¨ (Ù†ØµÙ Ù¾ÛŒØ§Ù„Ù‡)", "ØªÙˆØª Ø®Ø´Ú© 1 Ù‚Ø§Ø´Ù‚ ØºØ°Ø§Ø®ÙˆØ±ÛŒ + Ø¨Ø§Ø¯Ø§Ù… 5 Ø¹Ø¯Ø¯", "Ø§Ù…Ù„Øª Ø³ÙÛŒØ¯Ù‡ ØªØ®Ù… Ù…Ø±Øº (3 Ø³ÙÛŒØ¯Ù‡) + Ù†Ø§Ù† Ø³Ù†Ú¯Ú© 1 Ø¨Ø±Ø´ + Ø³Ø§Ù„Ø§Ø¯ ÙØµÙ„"],
            ["Ø±ÙˆØ² Ù¾Ù†Ø¬Ù…", "Ø¨Ù„ØºÙˆØ± Ú¯Ù†Ø¯Ù… (Ù†ØµÙ Ù¾ÛŒÙ…Ø§Ù†Ù‡ Ù¾Ø®ØªÙ‡) + Ø´ÛŒØ± Ú©Ù… Ú†Ø±Ø¨ (Ù†ØµÙ Ù„ÛŒÙˆØ§Ù†) + Ø¹Ø³Ù„ 1 Ù‚Ø§Ø´Ù‚ Ú†Ø§ÛŒØ®ÙˆØ±ÛŒ", "Ù…ÛŒÙˆÙ‡ ÙØµÙ„ (Ø§Ù†Ú¯ÙˆØ± 10 Ø¯Ø§Ù†Ù‡ Ú©ÙˆÚ†Ú©) + Ù¾Ø³ØªÙ‡ 10 Ø¹Ø¯Ø¯", "Ú©ÙˆÙØªÙ‡ Ù‚Ù„Ù‚Ù„ÛŒ Ø¨Ø§ Ø³Ø¨Ø²ÛŒØ¬Ø§Øª (3 Ø¹Ø¯Ø¯ Ú©ÙˆÚ†Ú©) + Ø¨Ø±Ù†Ø¬ Ø³ÙÛŒØ¯ Ù†ØµÙ Ù¾ÛŒÙ…Ø§Ù†Ù‡", "Ø¯ÙˆØº Ú©Ù… Ù†Ù…Ú© (1 Ù„ÛŒÙˆØ§Ù†) + Ù†Ø§Ù† Ø®Ø´Ú© 1 Ø¹Ø¯Ø¯", "Ù…Ø±Øº Ú¯Ø±ÛŒÙ„ Ø´Ø¯Ù‡ 100 Ú¯Ø±Ù… + Ù¾ÙˆØ±Ù‡ Ø³ÛŒØ¨ Ø²Ù…ÛŒÙ†ÛŒ (1 Ø³ÛŒØ¨ Ø²Ù…ÛŒÙ†ÛŒ Ú©ÙˆÚ†Ú©) + Ø³Ø§Ù„Ø§Ø¯ ÙØµÙ„"],
            ["Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ø±ÙˆØ² Ù¾Ù†Ø¬Ù…", "Ù†Ø§Ù† ØªØ³Øª Ø³Ø¨ÙˆØ³ Ø¯Ø§Ø± 1 Ø¨Ø±Ø´ + Ú©Ø±Ù‡ Ø¨Ø§Ø¯Ø§Ù… Ø²Ù…ÛŒÙ†ÛŒ 1 Ù‚Ø§Ø´Ù‚ ØºØ°Ø§Ø®ÙˆØ±ÛŒ + Ù…ÙˆØ² Ù†ØµÙ", "Ù…Ø§Ø³Øª Ú©Ù… Ú†Ø±Ø¨ (1 Ù¾ÛŒØ§Ù„Ù‡ Ú©ÙˆÚ†Ú©) + Ú¯Ø±Ø¯Ùˆ 2 Ø¹Ø¯Ø¯", "Ø®ÙˆØ±Ø§Ú© Ù…Ø±Øº Ø¨Ø§ Ù‚Ø§Ø±Ú† (100 Ú¯Ø±Ù… Ù…Ø±Øº + 1 ÙÙ†Ø¬Ø§Ù† Ù‚Ø§Ø±Ú†) + Ù†Ø§Ù† Ø³Ù†Ú¯Ú© 1 Ø¨Ø±Ø´", "Ù‡Ù†Ø¯ÙˆØ§Ù†Ù‡ (1 ÙÙ†Ø¬Ø§Ù† Ø®Ø±Ø¯ Ø´Ø¯Ù‡)", "Ù…Ø§Ù‡ÛŒ Ú©Ø¨Ø§Ø¨ÛŒ 100 Ú¯Ø±Ù… + Ø¨Ø±Ù†Ø¬ Ø³ÙÛŒØ¯ Ù†ØµÙ Ù¾ÛŒÙ…Ø§Ù†Ù‡ + Ø³Ø¨Ø²ÛŒØ¬Ø§Øª Ú©Ø¨Ø§Ø¨ÛŒ"],
            ["Ø±ÙˆØ² Ø´Ø´Ù…", "Ù¾Ù†ÛŒØ± Ú©Ù… Ù†Ù…Ú© 30 Ú¯Ø±Ù… + Ù†Ø§Ù† Ø³Ù†Ú¯Ú© 2 Ø¨Ø±Ø´ + Ú¯Ø±Ø¯Ùˆ 2 Ø¹Ø¯Ø¯ + Ú†Ø§ÛŒ Ú©Ù… Ø±Ù†Ú¯", "Ù…ÛŒÙˆÙ‡ ÙØµÙ„ (Ø³ÛŒØ¨ Ú©ÙˆÚ†Ú© 1 Ø¹Ø¯Ø¯) + Ø¨Ø§Ø¯Ø§Ù… 5 Ø¹Ø¯Ø¯", "Ø®ÙˆØ±Ø§Ú© Ú¯ÙˆØ´Øª Ø¨Ø§ Ø³Ø¨Ø²ÛŒØ¬Ø§Øª (100 Ú¯Ø±Ù… Ú¯ÙˆØ´Øª Ú©Ù… Ú†Ø±Ø¨ + 1 ÙÙ†Ø¬Ø§Ù† Ø³Ø¨Ø²ÛŒØ¬Ø§Øª) + Ø¨Ø±Ù†Ø¬ Ù‚Ù‡ÙˆÙ‡â€ŒØ§ÛŒ Ù†ØµÙ Ù¾ÛŒÙ…Ø§Ù†Ù‡", "Ù…Ø§Ø³Øª Ú©Ù… Ú†Ø±Ø¨ (1 Ù¾ÛŒØ§Ù„Ù‡ Ú©ÙˆÚ†Ú©) + Ù†Ø§Ù† Ø®Ø´Ú© 1 Ø¹Ø¯Ø¯", "Ø³ÙˆÙ¾ Ù…Ø±Øº Ø¨Ø§ Ø¬Ùˆ (1 Ú©Ø§Ø³Ù‡ Ù…ØªÙˆØ³Ø·) + Ù†Ø§Ù† Ø³Ù†Ú¯Ú© 1 Ø¨Ø±Ø´"],
            ["Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ø±ÙˆØ² Ø´Ø´Ù…", "ØªØ®Ù… Ù…Ø±Øº Ø¢Ø¨Ù¾Ø² 2 Ø¹Ø¯Ø¯ + Ù†Ø§Ù† Ø³Ù†Ú¯Ú© 1 Ø¨Ø±Ø´ + Ø®ÛŒØ§Ø± 1 Ø¹Ø¯Ø¯ Ú©ÙˆÚ†Ú©", "Ù‡ÙˆÛŒØ¬ Ú©ÙˆÚ†Ú© 2 Ø¹Ø¯Ø¯ + Ø­Ù…Øµ 2 Ù‚Ø§Ø´Ù‚ ØºØ°Ø§Ø®ÙˆØ±ÛŒ", "Ø¹Ø¯Ø³ Ù¾Ù„Ùˆ Ø¨Ø§ Ù…Ø±Øº (Ù†ØµÙ Ù¾ÛŒÙ…Ø§Ù†Ù‡) + Ø³Ø§Ù„Ø§Ø¯ Ø´ÛŒØ±Ø§Ø²ÛŒ", "Ù¾Ù†ÛŒØ± Ú©Ù… Ù†Ù…Ú© 30 Ú¯Ø±Ù… + Ù†Ø§Ù† Ø³Ù†Ú¯Ú© 1 Ø¨Ø±Ø´", "Ø§Ù…Ù„Øª Ø³Ø¨Ø²ÛŒØ¬Ø§Øª (2 ØªØ®Ù… Ù…Ø±Øº + Ø³Ø¨Ø²ÛŒØ¬Ø§Øª Ù…Ø¹Ø·Ø±) + Ù†Ø§Ù† Ø³Ù†Ú¯Ú© 1 Ø¨Ø±Ø´"],
            ["ÙˆØ¹Ø¯Ù‡ Ø¢Ø²Ø§Ø¯", "Ø§Ù†ØªØ®Ø§Ø¨ Ø¢Ø²Ø§Ø¯ (ØªØ±Ø¬ÛŒØ­Ø§Ù‹ Ø³Ø§Ù„Ù…) - Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ù…Ø§: ØµØ¨Ø­Ø§Ù†Ù‡ Ø§ÛŒØ±Ø§Ù†ÛŒ Ú©Ø§Ù…Ù„ (Ù†Ø§Ù†ØŒ Ù¾Ù†ÛŒØ±ØŒ Ø³Ø¨Ø²ÛŒØŒ Ú¯Ø±Ø¯Ùˆ)", "Ù…ÛŒÙˆÙ‡ ÙØµÙ„ Ø¨Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ù…Ø§", "ØºØ°Ø§ÛŒ Ù…ÙˆØ±Ø¯ Ø¹Ù„Ø§Ù‚Ù‡ Ø´Ù…Ø§ (Ø¯Ø± Ø­Ø¯ Ù…ØªØ¹Ø§Ø¯Ù„) - Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ù…Ø§: Ú†Ù„ÙˆÚ©Ø¨Ø§Ø¨ Ú©ÙˆØ¨ÛŒØ¯Ù‡ 1 Ø³ÛŒØ® + Ø³Ø§Ù„Ø§Ø¯", "Ø¢Ø¬ÛŒÙ„ Ø®Ø§Ù… Ø¨Ù‡ Ù…Ù‚Ø¯Ø§Ø± Ú©Ù…", "Ø³ÙˆÙ¾ Ø³Ø¨Ø²ÛŒØ¬Ø§Øª Ø®Ø§Ù†Ú¯ÛŒ + Ù†Ø§Ù† Ø³Ù†Ú¯Ú©"]
          ]
        }
      ]
    },
    {
      "title": "Ûµ. Ø¯Ø³ØªÙˆØ± Ù¾Ø®Øª ØºØ°Ø§Ù‡Ø§",
      "content": {
        "type": "list",
        "items": [
          {
            "label": "Ø®ÙˆØ±Ø§Ú© Ù…Ø±Øº Ø¨Ø§ Ø³Ø¨Ø²ÛŒØ¬Ø§Øª",
            "value": "Ù…ÙˆØ§Ø¯ Ù„Ø§Ø²Ù…: Ø³ÛŒÙ†Ù‡ Ù…Ø±Øº 100 Ú¯Ø±Ù…ØŒ Ù‡ÙˆÛŒØ¬ 1 Ø¹Ø¯Ø¯ØŒ Ù„ÙˆØ¨ÛŒØ§ Ø³Ø¨Ø² Ù†ØµÙ ÙÙ†Ø¬Ø§Ù†ØŒ Ù‚Ø§Ø±Ú† 5 Ø¹Ø¯Ø¯ØŒ Ø±ÙˆØºÙ† Ø²ÛŒØªÙˆÙ† 1 Ù‚Ø§Ø´Ù‚ Ú†Ø§ÛŒØ®ÙˆØ±ÛŒ. Ø±ÙˆØ´ ØªÙ‡ÛŒÙ‡: Ø³Ø¨Ø²ÛŒØ¬Ø§Øª Ø±Ø§ Ø®Ø±Ø¯ Ú©Ù†ÛŒØ¯. Ø¯Ø± ØªØ§Ø¨Ù‡ Ø±ÙˆØºÙ† Ø²ÛŒØªÙˆÙ† Ø±Ø§ Ú¯Ø±Ù… Ú©Ù†ÛŒØ¯ØŒ Ù…Ø±Øº Ø±Ø§ ØªÙØª Ø¯Ù‡ÛŒØ¯ØŒ Ø³Ù¾Ø³ Ø³Ø¨Ø²ÛŒØ¬Ø§Øª Ø±Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯ Ùˆ Ø¨Ø§ Ú©Ù…ÛŒ Ø¢Ø¨ Ø¨Ú¯Ø°Ø§Ø±ÛŒØ¯ ØªØ§ Ø¨Ù¾Ø²Ø¯."
          },
          {
            "label": "Ú©ØªÙ‡ Ú¯Ø´Ù†ÛŒØ² Ø¨Ø§ Ù…Ø§Ù‡ÛŒ",
            "value": "Ù…ÙˆØ§Ø¯ Ù„Ø§Ø²Ù…: Ø¨Ø±Ù†Ø¬ Ù†ØµÙ Ù¾ÛŒÙ…Ø§Ù†Ù‡ØŒ Ú¯Ø´Ù†ÛŒØ² ØªØ§Ø²Ù‡ 1 ÙÙ†Ø¬Ø§Ù†ØŒ Ù…Ø§Ù‡ÛŒ Ù‚Ø²Ù„â€ŒØ¢Ù„Ø§ 100 Ú¯Ø±Ù…ØŒ Ø±ÙˆØºÙ† Ø²ÛŒØªÙˆÙ† 1 Ù‚Ø§Ø´Ù‚ Ú†Ø§ÛŒØ®ÙˆØ±ÛŒ. Ø±ÙˆØ´ ØªÙ‡ÛŒÙ‡: Ø¨Ø±Ù†Ø¬ Ø±Ø§ Ø¨Ø§ Ú¯Ø´Ù†ÛŒØ² Ø®Ø±Ø¯ Ø´Ø¯Ù‡ Ø¨Ù¾Ø²ÛŒØ¯. Ù…Ø§Ù‡ÛŒ Ø±Ø§ Ø¨Ø§ Ø±ÙˆØºÙ† Ø²ÛŒØªÙˆÙ† Ùˆ Ú©Ù…ÛŒ Ù„ÛŒÙ…Ùˆ ØªÙØª Ø¯Ù‡ÛŒØ¯ ÛŒØ§ Ø¨Ø®Ø§Ø±Ù¾Ø² Ú©Ù†ÛŒØ¯."
          },
          {
            "label": "Ø³ÙˆÙ¾ Ø¬Ùˆ Ø¨Ø§ Ø³Ø¨Ø²ÛŒØ¬Ø§Øª",
            "value": "Ù…ÙˆØ§Ø¯ Ù„Ø§Ø²Ù…: Ø¬Ùˆ Ù¾Ø±Ú© Ù†ØµÙ Ù¾ÛŒÙ…Ø§Ù†Ù‡ØŒ Ù‡ÙˆÛŒØ¬ 1 Ø¹Ø¯Ø¯ØŒ Ú©Ø±ÙØ³ 1 Ø³Ø§Ù‚Ù‡ØŒ Ø¬Ø¹ÙØ±ÛŒ Ú©Ù…ÛŒØŒ Ø¢Ø¨ Ù…Ø±Øº Ú©Ù… Ù†Ù…Ú© 2 Ù„ÛŒÙˆØ§Ù†. Ø±ÙˆØ´ ØªÙ‡ÛŒÙ‡: Ø¬Ùˆ Ø±Ø§ Ø¨Ø§ Ø¢Ø¨ Ù…Ø±Øº Ø¨Ù¾Ø²ÛŒØ¯ØŒ Ø³Ø¨Ø²ÛŒØ¬Ø§Øª Ø®Ø±Ø¯ Ø´Ø¯Ù‡ Ø±Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯ ØªØ§ Ø¨Ù¾Ø²Ø¯. Ø¯Ø± Ø¢Ø®Ø± Ø¬Ø¹ÙØ±ÛŒ Ø®Ø±Ø¯ Ø´Ø¯Ù‡ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯."
          }
        ]
      }
    },
    {
      "title": "Û¶. Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§",
      "content": {
        "type": "list",
        "items": [
          "Ø¨Ø§ ØªÙˆØ¬Ù‡ Ø¨Ù‡ Ù¾ÛŒÙˆÙ†Ø¯ Ú©Ù„ÛŒÙ‡ØŒ Ù…ØµØ±Ù Ù¾Ø±ÙˆØªØ¦ÛŒÙ† Ø¨Ø§ÛŒØ¯ Ú©Ù†ØªØ±Ù„ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯. Ø§Ø² Ù…ØµØ±Ù Ø¨ÛŒØ´ Ø§Ø² Ø­Ø¯ Ù¾Ø±ÙˆØªØ¦ÛŒÙ† Ø®ÙˆØ¯Ø¯Ø§Ø±ÛŒ Ú©Ù†ÛŒØ¯.",
          "Ù…ØµØ±Ù Ù†Ù…Ú© Ø±Ø§ Ø¨Ù‡ Ø­Ø¯Ø§Ù‚Ù„ Ø¨Ø±Ø³Ø§Ù†ÛŒØ¯. Ø§Ø² ØºØ°Ø§Ù‡Ø§ÛŒ ÙØ±Ø¢ÙˆØ±ÛŒ Ø´Ø¯Ù‡ Ùˆ Ù¾Ø±Ù†Ù…Ú© Ø§Ø¬ØªÙ†Ø§Ø¨ Ú©Ù†ÛŒØ¯.",
          "Ø¨Ø§ ØªÙˆØ¬Ù‡ Ø¨Ù‡ Ù¾Ø§Ø±Ø§ØªÛŒØ±ÙˆØ¦ÛŒØ¯ØŒ Ø³Ø·Ø­ Ú©Ù„Ø³ÛŒÙ… Ùˆ ÙØ³ÙØ± Ø®ÙˆÙ† Ø¨Ø§ÛŒØ¯ Ø¨Ù‡ Ø¯Ù‚Øª Ú©Ù†ØªØ±Ù„ Ø´ÙˆØ¯.",
          "Ø¯Ø± ØµÙˆØ±Øª Ù‡Ø±Ú¯ÙˆÙ†Ù‡ ØªØºÛŒÛŒØ± Ø¯Ø± ÙˆØ¶Ø¹ÛŒØª Ø³Ù„Ø§Ù…ØªÛŒØŒ ÙÙˆØ±Ø§Ù‹ Ø¨Ø§ Ù¾Ø²Ø´Ú© Ù…Ø¹Ø§Ù„Ø¬ Ø®ÙˆØ¯ Ù…Ø´ÙˆØ±Øª Ú©Ù†ÛŒØ¯."
        ]
      }
    },
    {
      "title": "Û·. ØªÙˆØµÛŒÙ‡ Ù‡Ø§",
      "content": {
        "type": "list",
        "items": [
          "Ø±ÙˆØ²Ø§Ù†Ù‡ Ø­Ø¯Ø§Ù‚Ù„ 6-8 Ù„ÛŒÙˆØ§Ù† Ø¢Ø¨ Ù…ØµØ±Ù Ú©Ù†ÛŒØ¯ØŒ Ù…Ú¯Ø± Ø§ÛŒÙ†Ú©Ù‡ Ù¾Ø²Ø´Ú© Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ù…Ø§ÛŒØ¹Ø§Øª ØªØ¬ÙˆÛŒØ² Ú©Ø±Ø¯Ù‡ Ø¨Ø§Ø´Ø¯.",
          "ÙØ¹Ø§Ù„ÛŒØª Ø¨Ø¯Ù†ÛŒ Ø³Ø¨Ú© Ù…Ø§Ù†Ù†Ø¯ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ±ÙˆÛŒ Ø±ÙˆØ²Ø§Ù†Ù‡ 20-30 Ø¯Ù‚ÛŒÙ‚Ù‡ Ø±Ø§ Ø¯Ø± Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø®ÙˆØ¯ Ø¨Ú¯Ù†Ø¬Ø§Ù†ÛŒØ¯.",
          "ÙˆØ¹Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØºØ°Ø§ÛŒÛŒ Ø±Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ù…Ù†Ø¸Ù… Ùˆ Ø¯Ø± Ø³Ø§Ø¹Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø´Ø®Øµ Ù…ØµØ±Ù Ú©Ù†ÛŒØ¯.",
          "Ø§Ø² Ù…ØµØ±Ù Ø§Ù„Ú©Ù„ Ùˆ Ø³ÛŒÚ¯Ø§Ø± Ø¨Ù‡ Ø´Ø¯Øª Ù¾Ø±Ù‡ÛŒØ² Ú©Ù†ÛŒØ¯.",
          "Ø§Ø³ØªØ±Ø³ Ø®ÙˆØ¯ Ø±Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù†ÛŒØ¯ØŒ Ø²ÛŒØ±Ø§ Ø¨Ø± Ø³Ù„Ø§Ù…Øª Ú©Ù„ÛŒÙ‡â€ŒÙ‡Ø§ ØªØ£Ø«ÛŒØ± Ù…ÛŒâ€ŒÚ¯Ø°Ø§Ø±Ø¯."
        ]
      }
    },
    {
      "title": "Û¸. Ù…Ù†Ø§Ø¨Ø¹",
      "content": {
        "type": "list",
        "items": [
          "Journal of Renal Nutrition (2020). Nutritional Management of Kidney Transplant Recipients.",
          "Clinical Journal of the American Society of Nephrology (2019). Calcium and Phosphate Management in Chronic Kidney Disease.",
          "WHO Guidelines on Sodium Intake (2021).",
          "ADA Nutrition Recommendations for Kidney Disease (2022)."
        ]
      }
    }
  ],
  "footer": "aidastyar.com"
}
 ';     
         
            
            
            
            
           $response  = $json_string ;







            $history_manager = AI_Assistant_History_Manager::get_instance();
            // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± ØªØ§Ø±ÛŒØ®Ú†Ù‡
            $saved = $history_manager->save_history($user_id, $service_id , $service_name , $userData , $response);
            


            if (is_wp_error($saved)) {
                // Ø®Ø·Ø§ÛŒ ÙˆØ±Ø¯Ù¾Ø±Ø³
                $this->logger->log('History save WP_Error', [
                    'user_id' => $user_id,
                    'service_id' => $service_id,
                    'error_code' => $saved->get_error_code(),
                    'error_message' => $saved->get_error_message(),
                    'error_data' => $saved->get_error_data()
                ]);
              //  echo 'Ø®Ø·Ø§ÛŒ Ø³ÛŒØ³ØªÙ…ÛŒ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ: ' . $saved->get_error_message();
            } elseif ($saved) {
                // Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ²
                $this->logger->log('History saved successfully', [
                    'user_id' => $user_id,
                    'service_id' => $service_id,
                    'service-name' => $service_name ,
                    'history_id' => $saved,
                    'output_sample' => substr(strip_tags($response), 0, 100)
                ]);
              //  echo 'Ù†ØªØ§ÛŒØ¬ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.';
            } else {
                // Ø®Ø·Ø§ÛŒ Ø¹Ù…ÙˆÙ…ÛŒ
                $this->logger->log('History save failed', [
                    'user_id' => $user_id,
                    'service_id' => $service_id,
                    'html_size' => strlen($response),
                    'last_error' => error_get_last()
                ]);
              //  echo 'Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ ØªØ§Ø±ÛŒØ®Ú†Ù‡';
            }
            
            header('Content-Type: application/json; charset=utf-8');

            wp_send_json_success([
                'response' => $response,
                'remaining_credit' => $payment_handler->get_user_credit($user_id)
            ]);

        } catch (Exception $e) {

/*
            if (!empty($user_id) && !empty($price) && isset($payment_handler)) {
                $payment_handler->add_credit($user_id, $price, $description);
            }
            
*/            

            $this->logger->log_error($e->getMessage(), $_POST);
            wp_send_json_error($e->getMessage());
        }

        wp_die();
    }

    private function validate_request($prompt, $service_id, $user_id, $price, $payment_handler) {
        if (!is_user_logged_in()) {
            throw new Exception('Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø§ÛŒÙ† Ø³Ø±ÙˆÛŒØ³ Ø¨Ø§ÛŒØ¯ ÙˆØ§Ø±Ø¯ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø®ÙˆØ¯ Ø´ÙˆÛŒØ¯');
        }
        
        
        if (empty($prompt) || empty($service_id)) {
            throw new Exception('Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ ÙˆØ±ÙˆØ¯ÛŒ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ù‡Ø³ØªÙ†Ø¯');
        }

        if (!$payment_handler->has_enough_credit($user_id, $price)) {
            throw new Exception('.Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø­Ø³Ø§Ø¨ Ø´Ù…Ø§ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª');
        } 
    }

    private function call_deepseek_api($prompt) {
        $api_url = 'https://api.deepseek.com/v1/chat/completions';

        $args = [
            'headers' => [
                'Content-Type' => 'application/json',
                'Authorization' => 'Bearer ' . $this->api_key,
                'Accept' => 'application/json'
            ],
            'body' => json_encode([
                'model' => 'deepseek-chat',
                'messages' => [
                    ['role' => 'system', 'content' => 'You are a helpful assistant.'],
                    ['role' => 'user', 'content' => $prompt]
                ],
                'temperature' => 0.9,
                'max_tokens' => 5000
            ]),
            'timeout' => 120 ,
            'httpversion' => '1.1' // ðŸ“¡ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ù†Ø³Ø®Ù‡ HTTP Ø³Ø§Ø²Ú¯Ø§Ø±
        ];

        // Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ù‡ api Ø¯ÛŒÙ¾ Ø³ÛŒÚ©
        $response = wp_remote_post($api_url, $args);

        if (is_wp_error($response)) {
            $this->logger->log_error('DeepSeek API connection error', [
                'error' => $response->get_error_message(),
                'prompt' => $prompt
            ]);
            throw new Exception('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ± DeepSeek: ' . $response->get_error_message());
        }

        $response_code = wp_remote_retrieve_response_code($response);
        $body = wp_remote_retrieve_body($response);

        $this->logger->log('DeepSeek API response', [
            'status_code' => $response_code,
            'response' => $body
        ]);

        if ($response_code !== 200) {
            $this->logger->log_error('DeepSeek API returned error status', [
                'status_code' => $response_code,
                'response' => $body
            ]);
            throw new Exception('Ø®Ø·Ø§ Ø§Ø² Ø³Ù…Øª DeepSeek API. Ú©Ø¯ ÙˆØ¶Ø¹ÛŒØª: ' . $response_code);
        }

        $decoded_body = json_decode($body, true);

        if (empty($decoded_body['choices'][0]['message']['content'])) {
            $this->logger->log_error('Invalid API response structure', [
                'response_body' => $decoded_body
            ]);
            throw new Exception('Ù¾Ø§Ø³Ø® Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø² API Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯. Ø³Ø§Ø®ØªØ§Ø± Ù¾Ø§Ø³Ø®: ' . json_encode($decoded_body));
        }

        // ØªÙˆÙ„ÛŒØ¯ÛŒ Ø¨Ø§ ÙÛŒÙ„ØªØ± Ú©Ø¯Ù‡Ø§ÛŒ html
        // return sanitize_textarea_field($decoded_body['choices'][0]['message']['content']);
      
        // Ù…Ø³ØªÙ‚ÛŒÙ…Ø§Ù‹ HTML ØªÙˆÙ„ÛŒØ¯ÛŒ Ø±Ø§ Ø¨Ø¯ÙˆÙ† ÙÛŒÙ„ØªØ± Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†
        return $decoded_body['choices'][0]['message']['content'];
    }

    public function handle_unauthorized() {
        wp_send_json_error([
            'message' => 'Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø§ÛŒÙ† Ø³Ø±ÙˆÛŒØ³ Ø¨Ø§ÛŒØ¯ ÙˆØ§Ø±Ø¯ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø®ÙˆØ¯ Ø´ÙˆÛŒØ¯',
            'login_url' => wp_login_url()
        ], 401);
    }
}
